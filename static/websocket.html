
<!DOCTYPE html>
<html>
  <head>
    <title>Chat!</title>

    <meta charset="utf-8" />

    <script>
      'use strict'

      window.onload = () => {
        let conn = null

        const log = (msg) => {
          div_log.innerHTML += msg + '<br>'
          div_log.scroll(0, div_log.scrollTop + 1000)
        }

        const connect = () => {
          disconnect()

          const wsUri =
            (window.location.protocol === 'https:' ? 'wss://' : 'ws://') +
            "127.0.0.1:3000" +
            '/ws/'

          conn = new WebSocket(wsUri)
          log('Connecting...')

          conn.onopen = function () {
            log('Connected.')
            update_ui()
          }

          conn.onmessage = function (e) {
            log('Received: ' + e.data)
          }

          conn.onclose = function () {
            log('Disconnected.')
            conn = null

            update_ui()
          }
        }

        const disconnect = () => {
          if (conn) {
            log('Disconnecting...')
            conn.close()
            conn = null
